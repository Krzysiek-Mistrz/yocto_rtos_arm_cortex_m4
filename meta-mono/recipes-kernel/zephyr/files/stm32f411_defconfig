# Zephyr Kernel Configuration for STM32F411
# ARM Cortex-M4 @ 100MHz, 512KB Flash, 128KB RAM

# Architecture
CONFIG_ARM=y
CONFIG_CPU_CORTEX_M=y
CONFIG_CPU_CORTEX_M4=y
CONFIG_ARM_MPU=y
CONFIG_FPU=y
CONFIG_FPU_SHARING=y

# Platform
CONFIG_SOC_FAMILY_STM32=y
CONFIG_SOC_SERIES_STM32F4X=y
CONFIG_SOC_STM32F411XE=y

# Board
CONFIG_BOARD_STM32F411_DK=y

# Clock Configuration
CONFIG_SYS_CLOCK_HW_CYCLES_PER_SEC=100000000
CONFIG_CLOCK_CONTROL=y
CONFIG_CLOCK_STM32_HSE_CLOCK=8000000
CONFIG_CLOCK_STM32_SYSCLK_SRC_PLL=y
CONFIG_CLOCK_STM32_PLL_M_DIVISOR=8
CONFIG_CLOCK_STM32_PLL_N_MULTIPLIER=200
CONFIG_CLOCK_STM32_PLL_P_DIVISOR=2
CONFIG_CLOCK_STM32_AHB_PRESCALER=1
CONFIG_CLOCK_STM32_APB1_PRESCALER=2
CONFIG_CLOCK_STM32_APB2_PRESCALER=1

# Kernel Options
CONFIG_MULTITHREADING=y
CONFIG_NUM_PREEMPT_PRIORITIES=15
CONFIG_MAIN_STACK_SIZE=2048
CONFIG_IDLE_STACK_SIZE=512
CONFIG_THREAD_STACK_INFO=y
CONFIG_THREAD_MONITOR=y

# Memory Management
CONFIG_HEAP_MEM_POOL_SIZE=16384
CONFIG_MINIMAL_LIBC_MALLOC_ARENA_SIZE=8192

# Console and Shell
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
CONFIG_SERIAL=y
CONFIG_SHELL=y
CONFIG_SHELL_BACKEND_SERIAL=y
CONFIG_SHELL_PROMPT_UART="stm32:~$ "
CONFIG_SHELL_CMD_BUFF_SIZE=256
CONFIG_SHELL_PRINTF_BUFF_SIZE=256

# GPIO Support
CONFIG_GPIO=y
CONFIG_GPIO_STM32=y
CONFIG_GPIO_SHELL=y

# UART/USART Support
CONFIG_UART_STM32=y
CONFIG_UART_INTERRUPT_DRIVEN=y
CONFIG_UART_LINE_CTRL=y

# I2C Support
CONFIG_I2C=y
CONFIG_I2C_STM32=y
CONFIG_I2C_SHELL=y
CONFIG_I2C_SLAVE=y

# SPI Support
CONFIG_SPI=y
CONFIG_SPI_STM32=y
CONFIG_SPI_STM32_INTERRUPT=y

# USB Support
CONFIG_USB_DEVICE_STACK=y
CONFIG_USB_DEVICE_PRODUCT="STM32F411 Recovery Device"
CONFIG_USB_DEVICE_VID=0x0483
CONFIG_USB_DEVICE_PID=0x5740
CONFIG_USB_CDC_ACM=y
CONFIG_USB_MASS_STORAGE=n

# ADC Support
CONFIG_ADC=y
CONFIG_ADC_STM32=y

# PWM Support
CONFIG_PWM=y
CONFIG_PWM_STM32=y

# Watchdog
CONFIG_WATCHDOG=y
CONFIG_IWDG_STM32=y

# Flash and Storage
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_STM32_FLASH_PREFETCH=y

# File Systems (minimal)
CONFIG_FILE_SYSTEM=y
CONFIG_FILE_SYSTEM_LITTLEFS=y

# Networking (optional, can be disabled to save space)
CONFIG_NETWORKING=n

# Logging
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_PRINTK=y
CONFIG_LOG_BACKEND_UART=y

# Debugging
CONFIG_DEBUG=y
CONFIG_DEBUG_INFO=y
CONFIG_THREAD_NAME=y
CONFIG_ASSERT=y
CONFIG_ASSERT_LEVEL=2

# System
CONFIG_REBOOT=y
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

# Timers
CONFIG_TIMER=y
CONFIG_COUNTER=y

# Interrupt Controller
CONFIG_GEN_IRQ_VECTOR_TABLE=y

# Boot
CONFIG_BOOT_BANNER=y
CONFIG_BOOT_DELAY=0

# Application-specific features
CONFIG_PRINTK=y
CONFIG_EARLY_CONSOLE=y

# Recovery-specific features
CONFIG_FLASH_SHELL=y
CONFIG_DEVICE_SHELL=y
CONFIG_KERNEL_SHELL=y

# Size optimizations
CONFIG_SIZE_OPTIMIZATIONS=y
CONFIG_COMPILER_OPT="-Os"

# Disable unused features to save space
CONFIG_CPLUSPLUS=n
CONFIG_MINIMAL_LIBC=y
CONFIG_STDOUT_CONSOLE=y
