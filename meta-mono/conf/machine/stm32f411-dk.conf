#@TYPE: Machine
#@NAME: STM32F411 Development Kit
#@DESCRIPTION: Machine configuration for STM32F411 Development Kit, based on ARM Cortex-M4

# Include ARM Cortex-M4 tuning
require conf/machine/include/arm/armv7e-m/tune-cortexm4.inc

# STM32-specific variables
MACHINE_SOCARCH = "cortexm4"
SOC_FAMILY = "stm32f4:stm32f411"

# Machine features for embedded system
MACHINE_FEATURES = "serial usbdevice gpio i2c spi"

# Kernel/RTOS configuration
PREFERRED_PROVIDER_virtual/kernel ?= "zephyr-kernel"
KERNEL_IMAGETYPE = "zephyr.bin"
KERNEL_DEVICETREE = "st/stm32f411-dk.dtb"

# Serial console configuration (USART2 is typically connected to ST-Link)
SERIAL_CONSOLES = "115200;ttySTM0"

# Image configuration for embedded system
IMAGE_FSTYPES = "bin elf hex"

# Bootloader settings
PREFERRED_PROVIDER_virtual/bootloader = "u-boot-stm32"

# STM32F411 specifications
# - ARM Cortex-M4 @ 100MHz
# - 512KB Flash
# - 128KB SRAM
# - USB OTG FS
# - Multiple communication interfaces (USART, I2C, SPI)

# Extra image features for recovery and development
EXTRA_IMAGE_FEATURES += "tools-debug tools-sdk"

# Remove initramfs bundling (not typical for embedded systems)
INITRAMFS_IMAGE = ""
INITRAMFS_IMAGE_BUNDLE = "0"
