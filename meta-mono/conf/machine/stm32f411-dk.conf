#@TYPE: Machine
#@NAME: STM32F411CEU6 Black Pill
#@DESCRIPTION: Machine configuration for STM32F411CEU6 (Black Pill board), based on ARM Cortex-M4F

# Include ARM Cortex-M4 tuning
require conf/machine/include/arm/armv7m/tune-cortexm4.inc

# STM32-specific variables
MACHINE_SOCARCH = "cortexm4"
SOC_FAMILY = "stm32f4:stm32f411"

# Machine features for embedded system
MACHINE_FEATURES = "serial usbdevice gpio i2c spi"

# Kernel/RTOS configuration
PREFERRED_PROVIDER_virtual/kernel ?= "zephyr-recovery"
KERNEL_IMAGETYPE = "zephyr.bin"
# Zephyr handles device tree internally for blackpill_f411ce board

# Serial console configuration (USART1 on PA9/PA10 for Black Pill)
SERIAL_CONSOLES = "115200;ttyUSB0"

# For Zephyr RTOS, we don't use IMAGE_FSTYPES (no filesystem)
# Zephyr kernel outputs (bin, elf, hex) are handled by zephyr.bbclass

# Bootloader settings
PREFERRED_PROVIDER_virtual/bootloader = "u-boot-stm32"

# STM32F411CEU6 specifications (Black Pill)
# - ARM Cortex-M4F @ 100MHz (with FPU)
# - 512KB Flash
# - 128KB SRAM
# - USB OTG FS
# - 48-pin LQFP package
# - Multiple communication interfaces (USART, I2C, SPI)

# Extra image features for recovery and development
EXTRA_IMAGE_FEATURES += "tools-debug tools-sdk"

# Remove initramfs bundling (not typical for embedded systems)
INITRAMFS_IMAGE = ""
INITRAMFS_IMAGE_BUNDLE = "0"
